<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Textboard - 匿名掲示板</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { MessageSquare, Send, ArrowLeft, RefreshCw } = {
            MessageSquare: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            Send: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
            ArrowLeft: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
        };

        function Textboard() {
            const [boards, setBoards] = useState([
                { id: 'news', name: 'ニュース速報', description: '最新ニュースを語ろう' },
                { id: 'tech', name: '技術', description: 'プログラミング・IT技術' },
                { id: 'life', name: '生活', description: '日常生活の話題' },
                { id: 'hobby', name: '趣味', description: '趣味の話題' }
            ]);
            const [threads, setThreads] = useState({});
            const [posts, setPosts] = useState({});
            const [view, setView] = useState('boards');
            const [currentBoard, setCurrentBoard] = useState(null);
            const [currentThread, setCurrentThread] = useState(null);
            const [newThreadTitle, setNewThreadTitle] = useState('');
            const [newPost, setNewPost] = useState('');
            const [name, setName] = useState('');

            useEffect(() => {
                const savedThreads = localStorage.getItem('textboard_threads');
                const savedPosts = localStorage.getItem('textboard_posts');
                if (savedThreads) setThreads(JSON.parse(savedThreads));
                if (savedPosts) setPosts(JSON.parse(savedPosts));
            }, []);

            useEffect(() => {
                localStorage.setItem('textboard_threads', JSON.stringify(threads));
            }, [threads]);

            useEffect(() => {
                localStorage.setItem('textboard_posts', JSON.stringify(posts));
            }, [posts]);

            const openBoard = (board) => {
                setCurrentBoard(board);
                setView('threads');
            };

            const openThread = (thread) => {
                setCurrentThread(thread);
                setView('posts');
            };

            const createThread = () => {
                if (!newThreadTitle.trim() || !newPost.trim()) return;

                const threadId = `${currentBoard.id}_${Date.now()}`;
                const thread = {
                    id: threadId,
                    boardId: currentBoard.id,
                    title: newThreadTitle,
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    postCount: 1
                };

                const post = {
                    id: `${threadId}_1`,
                    threadId: threadId,
                    number: 1,
                    name: name.trim() || '名無しさん',
                    content: newPost,
                    timestamp: Date.now()
                };

                setThreads(prev => ({
                    ...prev,
                    [threadId]: thread
                }));

                setPosts(prev => ({
                    ...prev,
                    [post.id]: post
                }));

                setNewThreadTitle('');
                setNewPost('');
                setName('');
            };

            const createPost = () => {
                if (!newPost.trim()) return;

                const threadPosts = Object.values(posts).filter(p => p.threadId === currentThread.id);
                const postNumber = threadPosts.length + 1;
                const postId = `${currentThread.id}_${postNumber}`;

                const post = {
                    id: postId,
                    threadId: currentThread.id,
                    number: postNumber,
                    name: name.trim() || '名無しさん',
                    content: newPost,
                    timestamp: Date.now()
                };

                setPosts(prev => ({
                    ...prev,
                    [postId]: post
                }));

                setThreads(prev => ({
                    ...prev,
                    [currentThread.id]: {
                        ...prev[currentThread.id],
                        updatedAt: Date.now(),
                        postCount: postNumber
                    }
                }));

                setNewPost('');
                setName('');
            };

            const formatDate = (timestamp) => {
                const date = new Date(timestamp);
                const days = ['日', '月', '火', '水', '木', '金', '土'];
                return `${date.getFullYear()}/${String(date.getMonth() + 1).padStart(2, '0')}/${String(date.getDate()).padStart(2, '0')}(${days[date.getDay()]}) ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}:${String(date.getSeconds()).padStart(2, '0')}`;
            };

            const getBoardThreads = () => {
                if (!currentBoard) return [];
                return Object.values(threads)
                    .filter(t => t.boardId === currentBoard.id)
                    .sort((a, b) => b.updatedAt - a.updatedAt);
            };

            const getThreadPosts = () => {
                if (!currentThread) return [];
                return Object.values(posts)
                    .filter(p => p.threadId === currentThread.id)
                    .sort((a, b) => a.number - b.number);
            };

            return (
                <div style={{ minHeight: '100vh', backgroundColor: '#f3f4f6' }}>
                    {/* Header */}
                    <div style={{ backgroundColor: '#ea580c', color: 'white', padding: '1rem', boxShadow: '0 2px 4px rgba(0,0,0,0.1)' }}>
                        <div style={{ maxWidth: '56rem', margin: '0 auto', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                                <MessageSquare style={{ width: '28px', height: '28px' }} />
                                <h1 style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>Textboard</h1>
                            </div>
                            {view !== 'boards' && (
                                <button
                                    onClick={() => {
                                        if (view === 'posts') {
                                            setView('threads');
                                            setCurrentThread(null);
                                        } else {
                                            setView('boards');
                                            setCurrentBoard(null);
                                        }
                                    }}
                                    style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', padding: '0.5rem 1rem', backgroundColor: '#c2410c', borderRadius: '0.25rem', border: 'none', cursor: 'pointer', color: 'white' }}
                                >
                                    <ArrowLeft style={{ width: '18px', height: '18px' }} />
                                    戻る
                                </button>
                            )}
                        </div>
                    </div>

                    <div style={{ maxWidth: '56rem', margin: '0 auto', padding: '1rem' }}>
                        {/* Boards View */}
                        {view === 'boards' && (
                            <div style={{ backgroundColor: 'white', borderRadius: '0.25rem', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
                                <div style={{ borderBottom: '1px solid #e5e7eb', padding: '1rem', backgroundColor: '#f9fafb' }}>
                                    <h2 style={{ fontSize: '1.25rem', fontWeight: 'bold' }}>板一覧</h2>
                                </div>
                                <div>
                                    {boards.map((board, idx) => (
                                        <div
                                            key={board.id}
                                            onClick={() => openBoard(board)}
                                            style={{ 
                                                padding: '1rem', 
                                                borderBottom: idx < boards.length - 1 ? '1px solid #e5e7eb' : 'none',
                                                cursor: 'pointer'
                                            }}
                                            onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#f9fafb'}
                                            onMouseLeave={(e) => e.currentTarget.style.backgroundColor = 'white'}
                                        >
                                            <h3 style={{ fontWeight: 'bold', fontSize: '1.125rem', color: '#2563eb' }}>
                                                {board.name}
                                            </h3>
                                            <p style={{ fontSize: '0.875rem', color: '#6b7280', marginTop: '0.25rem' }}>
                                                {board.description}
                                            </p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Threads View */}
                        {view === 'threads' && currentBoard && (
                            <div>
                                <div style={{ backgroundColor: 'white', borderRadius: '0.25rem', boxShadow: '0 1px 3px rgba(0,0,0,0.1)', marginBottom: '1rem' }}>
                                    <div style={{ borderBottom: '1px solid #e5e7eb', padding: '1rem', backgroundColor: '#f9fafb' }}>
                                        <h2 style={{ fontSize: '1.25rem', fontWeight: 'bold' }}>{currentBoard.name}</h2>
                                        <p style={{ fontSize: '0.875rem', color: '#6b7280', marginTop: '0.25rem' }}>
                                            {currentBoard.description}
                                        </p>
                                    </div>

                                    {/* New Thread Form */}
                                    <div style={{ padding: '1rem', backgroundColor: '#fef3c7', borderBottom: '1px solid #e5e7eb' }}>
                                        <h3 style={{ fontWeight: 'bold', marginBottom: '0.75rem' }}>新規スレッド作成</h3>
                                        <input
                                            type="text"
                                            placeholder="スレッドタイトル"
                                            value={newThreadTitle}
                                            onChange={(e) => setNewThreadTitle(e.target.value)}
                                            style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', marginBottom: '0.5rem' }}
                                        />
                                        <input
                                            type="text"
                                            placeholder="名前(省略可)"
                                            value={name}
                                            onChange={(e) => setName(e.target.value)}
                                            style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', marginBottom: '0.5rem' }}
                                        />
                                        <textarea
                                            placeholder="本文"
                                            value={newPost}
                                            onChange={(e) => setNewPost(e.target.value)}
                                            style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', marginBottom: '0.5rem', height: '6rem', resize: 'vertical' }}
                                        />
                                        <button
                                            onClick={createThread}
                                            style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', padding: '0.5rem 1rem', backgroundColor: '#16a34a', color: 'white', borderRadius: '0.25rem', border: 'none', cursor: 'pointer' }}
                                        >
                                            <Send style={{ width: '16px', height: '16px' }} />
                                            スレッド作成
                                        </button>
                                    </div>

                                    {/* Thread List */}
                                    <div>
                                        {getBoardThreads().length === 0 ? (
                                            <div style={{ padding: '2rem', textAlign: 'center', color: '#6b7280' }}>
                                                スレッドがありません。最初のスレッドを作成しましょう!
                                            </div>
                                        ) : (
                                            getBoardThreads().map((thread, idx) => (
                                                <div
                                                    key={thread.id}
                                                    onClick={() => openThread(thread)}
                                                    style={{ 
                                                        padding: '1rem', 
                                                        borderBottom: idx < getBoardThreads().length - 1 ? '1px solid #e5e7eb' : 'none',
                                                        cursor: 'pointer'
                                                    }}
                                                    onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#f9fafb'}
                                                    onMouseLeave={(e) => e.currentTarget.style.backgroundColor = 'white'}
                                                >
                                                    <h3 style={{ fontWeight: 'bold', color: '#2563eb' }}>
                                                        {thread.title}
                                                    </h3>
                                                    <p style={{ fontSize: '0.875rem', color: '#6b7280', marginTop: '0.25rem' }}>
                                                        {thread.postCount}件のレス | 最終更新: {formatDate(thread.updatedAt)}
                                                    </p>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Posts View */}
                        {view === 'posts' && currentThread && (
                            <div>
                                <div style={{ backgroundColor: 'white', borderRadius: '0.25rem', boxShadow: '0 1px 3px rgba(0,0,0,0.1)', marginBottom: '1rem' }}>
                                    <div style={{ borderBottom: '1px solid #e5e7eb', padding: '1rem', backgroundColor: '#f9fafb' }}>
                                        <h2 style={{ fontSize: '1.25rem', fontWeight: 'bold' }}>{currentThread.title}</h2>
                                    </div>

                                    {/* Posts */}
                                    <div>
                                        {getThreadPosts().map((post, idx) => (
                                            <div 
                                                key={post.id} 
                                                style={{ 
                                                    padding: '1rem',
                                                    borderBottom: idx < getThreadPosts().length - 1 ? '1px solid #e5e7eb' : 'none'
                                                }}
                                            >
                                                <div style={{ display: 'flex', alignItems: 'baseline', gap: '0.75rem', marginBottom: '0.5rem' }}>
                                                    <span style={{ fontWeight: 'bold', color: '#15803d' }}>{post.number}</span>
                                                    <span style={{ fontWeight: 'bold', color: '#15803d' }}>:</span>
                                                    <span style={{ fontWeight: 'bold', color: '#15803d' }}>{post.name}</span>
                                                    <span style={{ fontSize: '0.875rem', color: '#6b7280' }}>
                                                        {formatDate(post.timestamp)}
                                                    </span>
                                                </div>
                                                <div style={{ marginLeft: '2rem', whiteSpace: 'pre-wrap' }}>
                                                    {post.content}
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Reply Form */}
                                    <div style={{ padding: '1rem', backgroundColor: '#fef3c7', borderTop: '1px solid #e5e7eb' }}>
                                        <h3 style={{ fontWeight: 'bold', marginBottom: '0.75rem' }}>返信する</h3>
                                        <input
                                            type="text"
                                            placeholder="名前(省略可)"
                                            value={name}
                                            onChange={(e) => setName(e.target.value)}
                                            style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', marginBottom: '0.5rem' }}
                                        />
                                        <textarea
                                            placeholder="本文"
                                            value={newPost}
                                            onChange={(e) => setNewPost(e.target.value)}
                                            style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', marginBottom: '0.5rem', height: '6rem', resize: 'vertical' }}
                                        />
                                        <button
                                            onClick={createPost}
                                            style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', padding: '0.5rem 1rem', backgroundColor: '#16a34a', color: 'white', borderRadius: '0.25rem', border: 'none', cursor: 'pointer' }}
                                        >
                                            <Send style={{ width: '16px', height: '16px' }} />
                                            書き込む
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<Textboard />, document.getElementById('root'));
    </script>
</body>
</html>